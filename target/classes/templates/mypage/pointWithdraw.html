<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>출금 신청</title>

    <style>
        body {
            background-color: #333; /* 연한 검정색 배경 */
            color: #FFF; /* 글자색 흰색으로 변경 */
            font-family: Arial, sans-serif; /* 원하는 폰트로 변경 */
        }

        h1 {
            text-align: center; /* 헤더 가운데 정렬 */
            padding: 20px; /* 헤더 상하 패딩 추가 */
            background-color: #444; /* 헤더 배경색 */
        }

        form {
            text-align: center; /* 폼 가운데 정렬 */
        }

        /* 입력 필드와 오류 메시지 스타일 */
        /* 입력 필드와 오류 메시지 스타일 */
        input[type="number"] {
            padding: 5px;
            border: 1px solid #777;
        }
        span#errorMessage {
            color: red;
            font-size: 1.2rem; /* 오류 메시지 글꼴 크기 변경 */
        }

        /* 버튼 스타일 */
        button {
            padding: 10px 20px; /* 버튼 내용 주위의 여백 설정 */
            margin: 10px; /* 버튼 사이 여백 설정 */
            background-color: #FF5733; /* 버튼 배경색 설정 */
            color: #FFF; /* 버튼 글자색 설정 */
            border: none; /* 버튼 테두리 없애기 */
            cursor: pointer; /* 포인터 커서 설정 */
        }

        button:hover {
            background-color: #E04324; /* 마우스 호버시 배경색 변경 */
        }

        button[type="submit"] {
            background-color: #33FF77; /* 출금 버튼 배경색 설정 */
        }

        button[type="submit"]:hover {
            background-color: #24E05A; /* 출금 버튼 마우스 호버시 배경색 변경 */
        }

        /* 추가된 스타일 */
        .info-table {
            border: 1px solid white; /* 테이블 선을 하얀색으로 설정 */
            margin: 0 auto; /* 가운데 정렬 */
            padding: 10px; /* 셀 안의 여백 설정 */
        }

        /* 추가된 스타일 */
        .info-table td {
            padding: 5px 10px; /* 셀 안의 여백 설정 */
            text-align: left; /* 셀 텍스트를 왼쪽 정렬 */
        }
    </style>

    <script>
        function validateForm() {
            var withdrawAmountField = document.getElementById("withdrawAmountField");
            var minusPointError = document.getElementById("minusPointError");
            var currentBalanceElement = document.getElementById("currentBalance");

            // 입력값이 비어 있는지 확인
            if (withdrawAmountField.value.trim() === "") {
                minusPointError.textContent = "출금 금액을 입력하세요";
                return false; // 폼 제출 중지
            }

            var maxValue = 10000000000;
            var inputValue = parseInt(withdrawAmountField.value, 10);

            // 현재 보유 머니
            var currentBalanceValue = parseInt(currentBalanceElement.textContent.replace(" 포인트", "").replace(/,/g, ""), 10);

            if (inputValue > maxValue) {
                minusPointError.textContent = "최대 100억까지 가능합니다";
                return false;
            } else if (inputValue > currentBalanceValue) {
                minusPointError.textContent = "출금 금액이 현재 보유 머니를 초과합니다";
                return false;
            } else if (inputValue === maxValue) {
                minusPointError.textContent = "최대 100억까지 가능합니다"; // 최대값과 같을 때 경고 메시지
                return false;
            }

            // 입력값이 보유 금액보다 적을 때 오류 메시지 삭제
            if (inputValue < currentBalanceValue) {
                minusPointError.textContent = "";
            }

            return true; // 유효성 검사를 통과하면 폼 제출 허용

        }
    </script>
</head>
<body>
<h1>출금 신청</h1>
<form method="POST" th:action="@{/mypage/withdraw}" onsubmit="return validateForm()">
    <!-- 테이블 형식의 정보 표시 -->
    <table class="info-table">
        <tr>
            <td>계좌번호 정보:</td>
            <td>477002-xx-xxxxxx</td>
        </tr>
        <tr>
            <td>은행명:</td>
            <td>국민은행</td>
        </tr>
        <tr>
            <input type="hidden" name="uid" th:value="${session.user}">
            <td><span style="color: orange;" th:text="${session.user}"></span>님 반갑습니다</td>
            <td></td>
        </tr>
        <tr>
            <td>보유 머니:</td>
            <td><span style="color: red;" th:text="${#numbers.formatInteger(userDto.point, 3, 'COMMA') + ' 포인트'}"></span></td>
        </tr>
    </table>
    <br><br> <!-- 줄 바꿈 추가 -->

    <!-- 텍스트 입력칸과 "출금" 버튼을 한 줄에 배치 -->
    <input type="number" name="withdrawAmount" min="0" id="withdrawAmountField" class="text-input">
    <button type="submit">출금</button>
    <br><br> <!-- 줄 바꿈 추가 -->

    <p id="minusPointError" style="color: red;"></p>
    <button type="button" onclick="location.href='/mypage'">돌아가기</button>
</form>

</body>
</html>